---
tags:
  - basics
---

Buckets aren't encrypted, **objects are**. Each object can use a different
encryption method. Both of the two types use encryption in transit for S3.

S3 object encryption is focused on encryption at rest. Encryption in
transit comes for free with S3

- **client** side encryption
  - objects being encrypted are done by the client before they leave.
  - the whole time it is sent as cypher text
  - encryption burder is on the customer and not AWS

- **server** side encryption
  - even though the data is encrypted in transit, the objects themselves
  are not encrypted at the beginning of transit. When the data reaches
  the S3 endpoint, it is still plaintext. Only once it has hit S3 completely,
  S3 will then encrypt before storage.
  - AWS will handle some or all of these processes.
## S3 Server Side Encryption (SSE)

Three general types:

##### SSE-C (Server-side encryption with customer provided keys)

- Customer is responsible for the keys themselves.
- Offloads CPU requirements for encryption to AWS.
- When placing an object in S3, it requires a key.
- S3 will see the original object throughout the process.
- Once the key and object arrive, it is encrypted. A hash of the key is
taken and attached to the object.
- The hash can identify if the specific key was used to encrypt the object.
- The key is then discarded after the hash is taken.

##### SSE-S3 AES256 (Server-side encryption w/ Amazon S3 managed keys)

- When putting data into S3, only need to provide plaintext.
- S3 generates S3 key. This is fully managed and rotated without
your control.
- When an object is added, S3 uses a **per-object key** to encrypt that object .
- After encryption the per-object key is encrypted using the S3 key and the plaintext version of the per-object key is discarded.
- The encrypted key is stored next to the encrypted object.
- Very little control how the keys are used.
- Most of situations, this is the default type of encryption
  - Strong algorythm
  - Data encrypted at rest
  - Little admin overhead.

- THREE PROBLEMS:
  - Regulatory enviromment where the keys and access needs to be controlled.
  - No way to control key material rotation.
  - No role seperation.
    - A full S3 admin can encrypt or decrypt data.

##### SSE-KMS (Server-side encryption w/ customer master keys stored in AWS KMS)

- Similar as above, except for the KMS Key.
- KMS Key is managed by KMS.
- Everytime an object is uploaded, **S3 uses a dedicated key to encrypt
that specific object.**
- The key is a data encryption key (DEK) that KMS generates using the KMS Key.
- S3 is provided with a plaintext version of the data encryption key as well as
a encrypted DEK.
- The plaintext key is used to encrypt the object then it is discarded.
- The encrypted data encrypted key is stored along with the encrypted object.

This method is prefered in the industry because it is better for role separation. If someone has admin rights to S3 they cannot necessarily encrypt or decrypt the data if they do not have the rights to access the KMS key.

Furthermore, roles can be split even more because a person might have access to encrypt using KMS key but not decrypt.


What are the three types of Server-Side Encryption (SSE) available in Amazon S3?:: SSE-S3 (with S3-managed keys), SSE-KMS (with AWS KMS-managed keys), and SSE-C (with customer-provided keys).

Can you have different encryption methods for objects within the same S3 bucket?:: Yes, each object in an S3 bucket can use a different encryption method, including a mix of SSE-S3, SSE-KMS, SSE-C, or client-side encryption.

## Bucket Keys

There is one problem with S3-KMS, for every upload to AWS, KMS generates an object-unique key. If there are too many requests it results in problems because KMS has a cost and it will go up based on the number of objects that you put in S3.

The generate DEK encryption key operation can only be run 5500, 10000, 50000 times per second (depends on what region you use).

We can minimize the KMS api call cost and use a **Bucket Key**. This is a key generated by KMS and this is a time limited bucket key. We can then use this key to generate DEKs for objects that are being put in s3.


## S3 Object Storage Classes

Picking a storage class can be done while uploading a specific object.
The default is S3 standard. Once an object is uploaded to a specific class,
it can be changed as long as the conditions are met

#### S3 Standard

The default AWS storage class that's used in S3. This is pretty good for most
cases and should be user default as well.

When you store an object in S3, it is stored in a bucket within a specific region. S3 is a **region resillent** service which means it can tolerate the
failure of an availability zone.

**This is done by replicating objects to at least 3+ AZs when they are uploaded.**

If an availability zone does fail, the object is safe in at least another two.

With S3 standard, it is never less than 3 availability zones.

This has 11, 9's for Object Durability and 4, 9's for availability.

Offers low latency and high throughput.

No **minimums** or **delays** or **penalties**

All of the other storage classes trade some compromises for another.

#### S3 Standard-IA

##### Overview

**S3 Standard-IA** is designed for data that is accessed **infrequently** but requires **rapid access** when needed. It offers a cost-effective storage solution by providing lower storage costs compared to S3 Standard, with additional charges for data retrieval. **Data is replicated atleast over 3 availability zones.**
##### Cost Efficiency

- **Lower Storage Costs**: Approximately **54% cheaper** than S3 Standard for storage.
- **Retrieval Fees**:
    - **Charged per GB of Data Retrieved**.
    - **No Base Retrieval Fee per Retrieval**:
        - **Charges are Proportional** to the amount of data retrieved.
        - If you retrieve less than 1 GB, you pay only for the exact amount retrieved.
        - **Example**: Retrieving 0.5 GB at $0.01 per GB costs **$0.005**.
- **Minimum Storage Duration**:
    - **30-day minimum** storage duration charge per object.
    - Deleting objects before 30 days still incurs charges for the full duration.
- **Minimum Object Size Charge**:
    - Objects are charged a minimum of **128 KB**.
    - Storing many small objects (<128 KB) may negate cost benefits.

##### Performance and Availability

- **Availability**: **99.9%**, slightly lower than S3 Standard's 99.99%.
- **Durability**: **99.999999999% (11 nines)**, same as S3 Standard.
- **Access Speed**: Immediate access with the same low latency and high throughput as S3 Standard.
Designed for data that isn't accessed often, long term storage, backups,
disaster recovery files. The requirement for data to be safe is most important.

#### S3 One Zone-Infrequent Access (S3 One Zone-IA)

- **Purpose**: Designed for data accessed less frequently but needed quickly.
- **Cost Efficiency**:
    - Costs **20% less** than S3 Standard-IA.
    - Same **minimum object size charge** of **128 KB**.
    - **30-day minimum storage duration** per object.
- **Data Storage**:
    - Data is stored in a **single Availability Zone (AZ)**.
    - No replication across multiple AZs.
- **Use Cases**:
    - Great choice for **secondary copies** or **backup copies** of primary data.
    - Suitable for data that is **easily re-creatable**.
- **Considerations**:
    - Avoid storing **critical or irreplaceable data**.
    - Not recommended for data requiring frequent access.
- **Availability**:
    - Designed for **99.5% availability**.
    - Cannot withstand an AZ failure; data may be lost if the AZ fails.

#### S3 Glacier - Instant Retrieval

- **Purpose**: For archive data that needs **immediate access**. Data is stored in multiple AZs.
- **Retrieval Time**: **Milliseconds** (same as S3 Standard).
- **Cost**:
    - Lower storage cost than S3 Standard-IA.
    - **Retrieval fees** apply per GB retrieved, retrieval costs more than S3 IA.
- **Minimum Storage Duration**: **90 days** per object.
- **Use Cases**:
    - Medical imaging, news media assets.
    - Data that is rarely accessed but must be available instantly.
- **Considerations**:
    - Suitable for data accessed **once per quarter**.
    - Objects deleted before 90 days incur pro-rated charges.

#### S3 Glacier Flexible Retrieval 

- **Purpose**: For long-term archives with **flexible retrieval times**. Data is stored in multiple AZs.
- **Retrieval Options**:
    - **Standard**: 3–5 hours.
    - **Expedited**: 1–5 minutes (additional cost).
    - **Bulk**: 5–12 hours (lowest cost).
    - After retrieval process,**data is stored in an S3 Standard IA temporarily, for access.**.
    - **First byte latency is minutes or hours.**
- **Cost**:
    - Lower storage cost than Glacier Instant Retrieval.
    - **Retrieval fees** vary based on retrieval option.
- **Minimum Storage Duration**: **90 days** per object.
- **Use Cases**:
    - Compliance archives, media assets.
    - Data accessed **1–2 times per year**.
- **Considerations**:
    - Objects deleted before 90 days incur pro-rated charges.
    - Objects cannot be made publicly accessible, any access of data requires a **retrieval process**.
#### S3 Glacier Deep Archive

- **Purpose**: **Lowest-cost** storage class for data rarely accessed. Data is stored in multiple AZs.
- **Retrieval Options**:
    - **Standard**: Up to **12 hours**.
    - **Bulk**: Up to **48 hours** (lowest cost).
    -  After retrieval process,**data is stored in an S3 Standard IA temporarily, for access.**.
    - **First byte latency is hours or days.**
- **Cost**:
    - Lowest storage cost among all S3 classes.
    - **Retrieval fees** apply, lowest per GB.
- **Minimum Storage Duration**: **180 days** per object.
- **Use Cases**:
    - Long-term digital preservation.
    - Regulatory compliance archives.
- **Considerations**:
    - Ideal for data accessed **once or twice a year** or less.
    - Objects deleted before 180 days incur pro-rated charges.
    - Objects cannot be made publicly accessible, any access of data requires a **retrieval process**.

#### S3 Intelligent-Tiering

- **Purpose**: Automatically optimizes storage costs by moving data between access tiers based on usage.
    
- **Access Tiers**:
    
    - **Frequent Access Tier**: For data accessed frequently.
    - **Infrequent Access Tier**: For data not accessed for **30 consecutive days**.
    - **Archive Instant Access Tier**: For data not accessed for **90 consecutive days**; retrieval in milliseconds.
    - **Archive Access Tier**: For data not accessed for **90 days**; retrieval within **3–5 hours**.
    - **Deep Archive Access Tier**: For data not accessed for **180 days**; retrieval within **12 hours**.
- **Automatic Tiering**:
    - Monitors object access patterns.
    - Moves objects to the most cost-effective tier automatically.
    - No performance impact or operational overhead.
- **Cost Structure**:
    - **Storage Costs**: Vary by tier; lower cost for colder tiers.
    - **Monitoring and Automation Fee**:
        - Charged per object per month.
        - Example: **$0.0025 per 1,000 objects**.
- **Retrieval Fees**:
    - **No retrieval fees** for data in Frequent and Infrequent Access tiers.
    - Retrieval fees apply for Archive Access and Deep Archive Access tiers.
- **Minimum Object Size**:
    - Objects smaller than **128 KB** are always stored in the Frequent Access tier.
    - Monitoring and automation fees still apply to these objects.
- **Minimum Storage Duration**:
    - **No minimum** for Frequent and Infrequent Access tiers.
    - **90 days** for Archive Instant Access and Archive Access tiers.
    - **180 days** for Deep Archive Access tier.
- **Use Cases**:
    - Data with **unknown or changing access patterns**.
    - Large datasets where access frequency is unpredictable.
- **Availability and Durability**:
    - **Availability**:
        - **99.9%** for Frequent and Infrequent Access tiers.
    - **Durability**:
        - **99.999999999% (11 nines)** across all tiers.
- **Considerations**:
    - Best for objects **larger than 128 KB** to maximize cost benefits.
    - Objects are monitored and tiered individually.
    - Suitable when you want to **optimize costs without manual intervention**.
