---
tags:
  - basics
---

## Overview
AWS Key Management Service (KMS) is a managed service that provides secure key management at a regional level. It is designed to make it easy to create, store, and manage cryptographic keys and control their use across the AWS services integrated with KMS.

## Features

### Regional Isolation
- KMS is a regional service, ensuring that keys are isolated to the region they were created in and are never transferred out.

### Public Service Connectivity
- Accessible by any entity with the necessary permissions within the public zone.

### Key Management
- Supports both symmetric and asymmetric keys.
- Performs cryptographic operations internally.
- Ensures keys adhere to the **FIPS 140-2 Level 2** security standard, with some features compliant at Level 3.

### Key Attributes
Each KMS key is a logical entity that includes:
- **ID**: Unique identifier for the key.
- **Creation Date**: The date when the key was created.
- **Policy**: Attached key policy that defines permissions.
- **Description**: User-defined description of the key.
- **State**: Current state of the key (e.g., enabled, disabled).
- Backed by physical key material that never leaves KMS.

### Data Encryption Keys (DEKs)
A KMS key is used  to generate a DEK. DEK is given to the user and KMS does not store it.
- **GenerateDataKey**: Used for generating DEKs for encrypting data larger than 4KB.
- KMS does not store the DEKs. Once it hands the keys over, it does not care.

When the DEK is generated (using a KMS key), KMS provides two versions.

- Plaintext Version - This can be used immediately for encryption.
- Ciphertext Version - Encrypted version of the DEK. This is encrypted by the customer master key that generated it.

DEK is generated right before something is encrypted.
The data is encrypted with the plaintext version to generate Cyphertext.
After this, the plaintext version is discarded.
The encrypted data and the encrypted DEK are stored next to each other.

### Key Rotation
- **AWS Managed Keys**: Automatically rotated approx once per year, and this rotation cannot be disabled.
- **Customer Managed Keys**: Rotated annually by default is off but can be enabled.

### Key Policies
- Each customer-managed key has a unique key policy that must allow IAM roles and users to use the key, following the trust hierarchy established within AWS.

## Important Concepts

### Types of Keys
- **AWS Owned Keys**: Managed entirely by AWS.
- **Customer Owned Keys**:
  - **AWS Managed**: Managed by AWS but gives users less configuration.
  - **Customer Managed**: Fully managed by the customer, offering the most flexibility and control.

### Key Aliases
- Aliases can be created for easier key management and use. These are also regional.

### Security and Compliance
- Adheres to stringent security standards to ensure the cryptographic keys are managed securely.

## Usage Tips
- Ideal for managing encryption keys used for data at rest or in transit across AWS services.
- Consider the type of key management that best fits your security and operational needs, especially in terms of key rotation and policy management.



## Usage Example 

![[KMS.png]]

## Workflow

**Data Encryption Kyes (DEKs)** are a type of key generated by KMS using a KMS key, using the GenerateDataKey operation. 
This key can work on data that is more than 4kb in size.

DEKs are linked to the KMS keys that are linked to them so KMS can tell that a specific data encryption key was created using a specific KMS key.

KMS does not store the DEK anyway, it provides it to you and then it discards it.


#### Key Policy (resource policy)

Every customer managed key  has one.

Unlike other policies, the key policy must be told to trust the key.

In order for IAM to work, IAM is trusted by the account, and the account
must be trusted by the key.



What does AWS KMS provide when generating a DEK, and how are these keys managed?:: When generating a DEK, AWS KMS provides a plaintext version for immediate use and a ciphertext version that is encrypted under the CMK. KMS does not store the ciphertext DEK; instead, it is the user's responsibility to securely store this ciphertext DEK alongside the encrypted data.
<!--SR:!2024-08-31,3,250-->

